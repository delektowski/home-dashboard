<div class="card" [ngClass]="{'hide-uninitialized': !isInitialized}">
  <p-panel [toggleable]="true" [collapsed]="true" (onBeforeToggle)="onCollapsedChange($event)">
    <ng-template #header>
      <span class="header-place-name">{{ measuresLastAggregated?.placeName || '' }}</span>
      <span [class]="'container__spinner'">
        @if (homeMeasuresService.isSpinner) {
          <p-progress-spinner strokeWidth="8" fill="transparent" animationDuration=".5s"
                              [style]="{ width: '1rem', height: '1rem' }"/>
        }
      </span>
      <div class="container__badges">
        @for (key of measuresLastAggregatedKeys ; track key) {
          @if (measuresLastAggregated ? measuresLastAggregated[key] || '' : '') {
            <ng-container *ngTemplateOutlet="badgeTemplate, context:{
             value: measuresLastAggregated ? measuresLastAggregated[key] || '' : '', createdAt: key === 'temperature' ? measuresLastAggregated?.createdAt : undefined, measureType: key
          } "/>
          }
        }
      </div>
    </ng-template>
    <ng-content></ng-content>
  </p-panel>
</div>


<!--TEMPLATES-->
<ng-template #badgeTemplate let-value="value"let-createdAt="createdAt"
             let-measureType="measureType">
  <div class="container__badge badge-temperature"
       [ngClass]="{'badge-temperature':temperatureKeys.has(measureType), 'badge-humidity': !temperatureKeys.has(measureType)}"
       title="measureType">
    <p-badge styleClass="badge-width" value="{{value}} {{temperatureKeys.has(measureType) ? '&deg;C' : '%'}} " badgeSize="xlarge"
             [severity]="severityConfig.get(measureType)?.() || defaultSeverity()"/>

  </div>
  @if (createdAt) {
    <p class="created-at">{{ createdAt | date:'H:mm' }}</p>
  }
</ng-template>
